while (list($id, $name) = each($attr_array[1])) {
    $dom[$key]['attribute'][strtolower($name)] = $attr_array[2][$id];
}
need to be

foreach ($attr_array[1] as $id => $name) {
    $dom[$key]['attribute'][strtolower($name)] = $attr_array[2][$id];
}